---
import { PATTERNS } from './patterns';
import styles from './styles.module.css';

interface Props {
  /** Size of the blob in pixels */
  size?: number;
  /** Animation duration in milliseconds */
  duration?: number;
  /** Number of animation steps/patterns to use. Will be selected randomly. Creates seamless loop */
  stepCount?: number;
}

const { size = 100, duration = 20000, stepCount = 6 } = Astro.props;

const gradientId = `gradient-${Math.random().toString(36).substring(2, 11)}`;

function getRandomPatterns(patterns: string[], count: number): string[] {
  const shuffled = [...patterns].sort(() => Math.random() - 0.5);
  const selected = shuffled.slice(0, Math.min(count, patterns.length));

  // Add the first pattern at the end to create a seamless loop
  if (selected.length > 0) {
    selected.push(selected[0]);
  }

  return selected;
}

const selectedPatterns = getRandomPatterns(PATTERNS, stepCount);

const animationValues = selectedPatterns.join(';');
---

<div 
  class={styles.blobWrapper} 
  style={`--size: ${size}px`}
>
  <svg viewBox="0 0 500 500" class={styles.blob} aria-label="Animated blob decoration" aria-hidden="true">
    <defs>
      <linearGradient id={gradientId} x1="0%" y1="0%" x2="0%" y2="100%">
        <stop class={styles.gradientStart} offset="0%" />
        <stop class={styles.gradientEnd} offset="100%" />
      </linearGradient>
    </defs>
    <path fill={`url(#${gradientId})`}>
      <animate
        attributeName="d"
        dur={`${duration}ms`}
        repeatCount="indefinite"
        values={animationValues}
        calcMode="linear"
      />
    </path>
  </svg>
</div>
