---
import { Image, getImage } from 'astro:assets';
import { getCollection } from 'astro:content';
import InternalPolaroid from './InternalPolaroid/InternalPolaroid.tsx';
import ChildrenVampireWorld from '../../assets/polaroid_backgrounds/childrenVampireWorld.png';

interface Props {
  keyName: string;
  size?: 'sm' | 'md' | 'lg';
}

const { keyName, size } = Astro.props;

const characters = await getCollection('characters');
const characterRaw = characters.find(character => character.slug === keyName);
const { altText = '', image, name = 'john-doe', pattern } = characterRaw?.data || {};

let optimizedBackground;

if (pattern === 'childrenVampireWorld') {
  optimizedBackground = await getImage({ src: ChildrenVampireWorld, format: 'webp' });
}

const backgroundURL = optimizedBackground?.src || '';
---

<InternalPolaroid client:load
  backgroundURL={backgroundURL}
  name={name}
  size={size}
>
  {image && <Image src={image} alt={altText} format="webp" quality="mid" />}
</InternalPolaroid>
